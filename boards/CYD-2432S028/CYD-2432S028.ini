; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

##################################### CYD MODELS ####################################################
[CYD_base]
board = CYD-2432S028
monitor_speed = 115200
board_build.partitions = custom_4Mb_full.csv
build_src_filter =${env.build_src_filter} +<../boards/CYD-2432S028>
build_flags =
        ${env.build_flags}
        -Iboards/CYD-2432S028
        -Os
        -DCORE_DEBUG_LEVEL=0
        -DCONFIG_ESP32_JTAG_SUPPORT_DISABLE=1
        ;-DARDUINO_USB_CDC_ON_BOOT=1  ; Used only in ESP32-S3 to make Serial Comands work

        -DCYD=1         ;key for new device,
                                        ;mykeyboard.cpp: need map buttons an/or touchscreen and battery status value,
                                        ;settings.cpp:   need map brighness control
                                        ;main.cpp:                  need set startup
                                        ;serialcmds.cpp: need set power off command

        ;Features Enabled
        ;FM Radio
        -DFM_SI4713=1 ;Uncomment to activate FM Radio using Adafruit Si4713
        -DFM_RSTPIN=40
        ;-DLITE_VERSION=1 ;limits some features to save space for M5Launcher Compatibility
        ;Microphone
        ;-DMIC_SPM1423=1 ;uncomment to enable Applicable for SPM1423 device
        -DPIN_CLK=-1
        -DI2S_SCLK_PIN=-1
        -DI2S_DATA_PIN=-1
        -DPIN_DATA=-1

        ;RGB LED runned by xylopyrographer/LiteLED@^1.2.0 library
        ;-DHAS_RGB_LED=1  ;uncomment to enable
        -DRGB_LED=-1

        ;Have RTC Chip
        ;-DHAS_RTC=1

        ;Speaker to run music, compatible with NS4168 - ENABLED for CYD-3248S035C
        -DHAS_NS4168_SPKR=1 ;uncomment to enable
        -DBCLK=4        ; Audio BCLK pin for CYD-3248S035C
        -DWCLK=26       ; Audio LRCLK pin for CYD-3248S035C
        -DDOUT=22       ; Audio DIN pin for CYD-3248S035C

        ;Can run USB as HID
        ;-DUSB_as_HID=1 ;uncomment to enable
        -DBAD_TX=GROVE_SDA
        -DBAD_RX=GROVE_SCL

        ; SERIAL (GPS) dedicated pins
        -DSERIAL_TX=3
        -DSERIAL_RX=1

        ;Battery ADC read pin
        ;-DBAT_PIN=10

        ;Buttons configuration
        -DHAS_BTN=0
        -DBTN_ALIAS='"Ok"'
        -DBTN_PIN=0

        ;-DALLOW_ALL_GPIO_FOR_IR_RF=1 ; Set this option to make use of all GPIOs, from 1 to 44 to be chosen, except TFT and SD pins

        ;Infrared Led default pin and state - MODIFIED for CYD-3248S035C
        -DIR_TX_PINS='{{"Pin 16", 16}, {"Pin 17", 17}}'
        -DIR_RX_PINS='{{"Pin 16", 16}, {"Pin 17", 17}, {"Pin 34", 34}}'
        -DLED=16                ;CHANGED from 22 to 16 for CYD-3248S035C
        -DLED_ON=HIGH
        -DLED_OFF=LOW

        ;Radio Frequency (one pin modules) pin setting - MODIFIED for CYD-3248S035C
        -DRF_TX_PINS='{{"Pin 16", 16}, {"Pin 17", 17}}'
        -DRF_RX_PINS='{{"Pin 16", 16}, {"Pin 17", 17}, {"Pin 34", 34}}'

        ;CC1101 SPI connection pins - MODIFIED for CYD-3248S035C
        ; best connection pins for higher speed https://docs.espressif.com/projects/esp-idf/en/latest/esp32s3/api-reference/peripherals/spi_master.html#gpio-matrix-and-io-mux
        -DUSE_CC1101_VIA_SPI
        -DCC1101_GDO0_PIN=16    ; CHANGED from 22 to 16
        -DCC1101_SS_PIN=17      ; CHANGED from 27 to 17
        -DCC1101_MOSI_PIN=SPI_MOSI_PIN
        -DCC1101_SCK_PIN=SPI_SCK_PIN
        -DCC1101_MISO_PIN=SPI_MISO_PIN
        ;-DCC1101_GDO2_PIN=14  ; optional

        ; connections are the same as CC1101 - MODIFIED for CYD-3248S035C
        -DUSE_NRF24_VIA_SPI
        -DNRF24_CE_PIN=16       ; CHANGED from 22 to 16
        -DNRF24_SS_PIN=17       ; CHANGED from 27 to 17 (chip select)
        -DNRF24_MOSI_PIN=SPI_MOSI_PIN
        -DNRF24_SCK_PIN=SPI_SCK_PIN
        -DNRF24_MISO_PIN=SPI_MISO_PIN

        -DUSE_W5500_VIA_SPI
        -DW5500_SS_PIN=17       ; CHANGED from 27 to 17
        -DW5500_MOSI_PIN=SPI_MOSI_PIN
        -DW5500_SCK_PIN=SPI_SCK_PIN
        -DW5500_MISO_PIN=SPI_MISO_PIN
        -DW5500_INT_PIN=16      ; CHANGED from 22 to 16

        ;Font sizes, depending on device
        -DFP=1
        -DFM=2
        -DFG=3

        ;Screen Setup
        -DHAS_SCREEN=1
        -DROTATION=1
        -DBACKLIGHT=21
        -DMINBRIGHT=160

        ;TFT_eSPI Setup - MODIFIED for CYD-3248S035C (ST7796 Driver, 480x320)
        -DUSER_SETUP_LOADED=1
        -DST7796_DRIVER=1       ; CHANGED from ILI9341_2_DRIVER=1 to ST7796_DRIVER=1
        -DUSE_HSPI_PORT=1
        -DTFT_HEIGHT=320        ; Portrait height
        -DTFT_WIDTH=480         ; Landscape width (3.5" display)
        -DTFT_MISO=12          ; Display SPI MISO
        -DTFT_MOSI=13          ; Display SPI MOSI
        -DTFT_SCLK=14          ; Display SPI SCLK
        -DTFT_CS=15            ; Display SPI CS
        -DTFT_DC=2             ; Display DC pin
        -DTFT_RST=27           ; Display Reset pin
        -DTFT_BACKLIGHT_ON=HIGH
        -DSMOOTH_FONT=1

        ;TouchScreen Controller - MODIFIED for CYD-3248S035C (Capacitive GT911)
        -DHAS_TOUCH=1
        -DHAS_CAPACITIVE_TOUCH=1  ; Enable capacitive touch for GT911

        ;SD Card Setup pins (same as original)
        -DSDCARD_CS=5
        -DSDCARD_SCK=18
        -DSDCARD_MISO=19
        -DSDCARD_MOSI=23

        ;tft Brighness Control
        -DTFT_BRIGHT_CHANNEL=0
        -DTFT_BRIGHT_Bits=8
        -DTFT_BRIGHT_FREQ=5000

        ;Default I2C port - MODIFIED for CYD-3248S035C (GT911 Touch Controller)
        -DGROVE_SDA=33          ; CHANGED from -1 to 33 (GT911 SDA)
        -DGROVE_SCL=32          ; CHANGED from -1 to 32 (GT911 SCL)

        -DSPI_SCK_PIN=18
        -DSPI_MOSI_PIN=23
        -DSPI_MISO_PIN=19
        -DSPI_SS_PIN=17         ; CHANGED from 27 to 17
        -DDEVICE_NAME='"CYD-3248S035C"'  ; CHANGED device name

lib_deps =
        ${env.lib_deps}

##################################### CYD MODELS ####################################################
[env:CYD-2432S028]
extends=CYD_base
build_flags =
        ${CYD_base.build_flags}
        -DTFT_BL=21
        -DSPI_FREQUENCY=80000000      ; INCREASED from 40MHz to 80MHz for ST7796
        -DSPI_READ_FREQUENCY=20000000 ; INCREASED from 16MHz to 20MHz
        -DSPI_TOUCH_FREQUENCY=2500000 ; Keep 2.5MHz for touch
        -DTOUCH_CS=-1                 ; Capacitive touch uses I2C, not SPI CS
        -DTOUCH_SDA=33               ; GT911 I2C SDA pin
        -DTOUCH_SCL=32               ; GT911 I2C SCL pin
        -DTOUCH_INT=36               ; GT911 interrupt pin
        -DTOUCH_RST=25               ; GT911 reset pin
        -DDEVICE_NAME='"CYD-3248S035C"'

[env:CYD-2USB]
extends=env:CYD-2432S028
build_flags =
        ${env:CYD-2432S028.build_flags}
        -DTFT_INVERSION_ON
        -DDEVICE_NAME='"CYD-2USB"'

[env:LAUNCHER_CYD-2USB]
extends=env:CYD-2432S028
build_flags =
        ${env:CYD-2432S028.build_flags}
        -DCONFIG_ESP32_JTAG_SUPPORT_DISABLE=1
        -DTFT_INVERSION_ON
        -DLITE_VERSION=1
        -DDEVICE_NAME='"LAUNCHER_CYD-2USB"'

[env:CYD-2432W328C]
extends = CYD_base
build_flags =
        ${CYD_base.build_flags}
        -DTFT_INVERSION_ON
        -DTFT_BL=27
        -DSPI_FREQUENCY=55000000
        -DSPI_READ_FREQUENCY=20000000
        -DSPI_TOUCH_FREQUENCY=2500000
        -DHAS_CAPACITIVE_TOUCH=1
         -DTOUCH_CS=-1 # This pin is used for I2C communication, not for CS SPI control in this device
        -DDEVICE_NAME='"CYD-2432W328C"'

[env:LAUNCHER_CYD-2432S028]
extends=env:CYD-2432S028
build_flags =
        ${env:CYD-2432S028.build_flags}
        -DCONFIG_ESP32_JTAG_SUPPORT_DISABLE=1
        -DLITE_VERSION=1
        -DDEVICE_NAME='"LAUNCHER_CYD-2432S028"'

[env:CYD-2432W328C_2] # commom to CYD-2432S024 Capacitive board
extends = env:CYD-2432W328C
build_unflags =
        -DTFT_INVERSION_ON
        -DDEVICE_NAME='"CYD-2432W328C_2"'

[env:LAUNCHER_CYD-2432W328C]
extends=env:CYD-2432W328C
build_flags =
        ${env:CYD-2432W328C.build_flags}
        -DCONFIG_ESP32_JTAG_SUPPORT_DISABLE=1
        -DLITE_VERSION=1
        -DDEVICE_NAME='"LAUNCHER_CYD-2432W328C"'

[env:CYD-2432W328R-or-S024R]
extends = CYD_base
build_flags =
        ${CYD_base.build_flags}
        -DTFT_INVERSION_ON
        -DTFT_BL=27
        -DTOUCH_OFFSET_ROTATION=1
        -DSPI_FREQUENCY=55000000
        -DSPI_READ_FREQUENCY=20000000
        -DSPI_TOUCH_FREQUENCY=2500000
        -DTOUCH_CS=33
        -DUSE_TFT_eSPI_TOUCH
        -DTOUCH_CONFIG_INT_GPIO_NUM=36
        -DDEVICE_NAME='"CYD-2432W328R-or-S024R"'

[env:LAUNCHER_CYD-2432W328R-or-S024R]
extends = env:CYD-2432W328R-or-S024R
board_build.partitions = custom_4Mb.csv
build_flags =
        ${env:CYD-2432W328R-or-S024R.build_flags}
        -DCORE_DEBUG_LEVEL=0
        -DCONFIG_ESP32_JTAG_SUPPORT_DISABLE=1
        -DLITE_VERSION=1
        -DDEVICE_NAME='"LAUNCHER_CYD-2432W328R-or-S024R"'

################################# END OF CYD MODELS ####################################################