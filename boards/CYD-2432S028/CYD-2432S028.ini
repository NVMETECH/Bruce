[CYD_base]
board = CYD-2432S028  ; TETAP pakai board name ini
monitor_speed = 115200
board_build.partitions = custom_4Mb_full.csv
build_src_filter =${env.build_src_filter} +<../boards/CYD-2432S028>
build_flags =
        ${env.build_flags}
        -Iboards/CYD-2432S028
        -Os
        -DCORE_DEBUG_LEVEL=0
        -DCONFIG_ESP32_JTAG_SUPPORT_DISABLE=1

        -DCYD=1

        ;Features Enabled
        ;FM Radio
        -DFM_SI4713=1
        -DFM_RSTPIN=40
        
        ;Microphone
        -DPIN_CLK=-1
        -DI2S_SCLK_PIN=-1
        -DI2S_DATA_PIN=-1
        -DPIN_DATA=-1

        ;RGB LED
        -DRGB_LED=-1

        ;Speaker (Enable untuk CYD-3248S035C yang punya audio)
        -DHAS_NS4168_SPKR=1    ; UNCOMMENT ini untuk audio CYD-3248S035C
        -DBCLK=4               ; Audio BCLK pin
        -DWCLK=26              ; Audio LRCLK pin
        -DDOUT=22              ; Audio DIN pin

        ;USB as HID
        -DBAD_TX=GROVE_SDA
        -DBAD_RX=GROVE_SCL

        ; SERIAL pins
        -DSERIAL_TX=3
        -DSERIAL_RX=1

        ;Buttons configuration
        -DHAS_BTN=0
        -DBTN_ALIAS='"Ok"'
        -DBTN_PIN=0

        ;Infrared Led pins (ubah untuk GPIO yang available di 3248S035C)
        -DIR_TX_PINS='{{"Pin 16", 16}, {"Pin 17", 17}}'
        -DIR_RX_PINS='{{"Pin 16", 16}, {"Pin 17", 17}, {"Pin 34", 34}}'
        -DLED=16                ; Ubah dari 22 ke 16
        -DLED_ON=HIGH
        -DLED_OFF=LOW

        ;Radio Frequency pins
        -DRF_TX_PINS='{{"Pin 16", 16}, {"Pin 17", 17}}'
        -DRF_RX_PINS='{{"Pin 16", 16}, {"Pin 17", 17}, {"Pin 34", 34}}'

        ;CC1101 SPI pins
        -DUSE_CC1101_VIA_SPI
        -DCC1101_GDO0_PIN=16    ; Ubah dari 22 ke 16
        -DCC1101_SS_PIN=17      ; Ubah dari 27 ke 17
        -DCC1101_MOSI_PIN=SPI_MOSI_PIN
        -DCC1101_SCK_PIN=SPI_SCK_PIN
        -DCC1101_MISO_PIN=SPI_MISO_PIN

        ;NRF24 SPI pins
        -DUSE_NRF24_VIA_SPI
        -DNRF24_CE_PIN=16       ; Ubah dari 22 ke 16
        -DNRF24_SS_PIN=17       ; Ubah dari 27 ke 17
        -DNRF24_MOSI_PIN=SPI_MOSI_PIN
        -DNRF24_SCK_PIN=SPI_SCK_PIN
        -DNRF24_MISO_PIN=SPI_MISO_PIN

        -DUSE_W5500_VIA_SPI
        -DW5500_SS_PIN=17       ; Ubah dari 27 ke 17
        -DW5500_MOSI_PIN=SPI_MOSI_PIN
        -DW5500_SCK_PIN=SPI_SCK_PIN
        -DW5500_MISO_PIN=SPI_MISO_PIN
        -DW5500_INT_PIN=16      ; Ubah dari 22 ke 16

        ;Font sizes
        -DFP=1
        -DFM=2
        -DFG=3

        ;Screen Setup
        -DHAS_SCREEN=1
        -DROTATION=1
        -DBACKLIGHT=21
        -DMINBRIGHT=160

        ;TFT_eSPI Setup - INI YANG PALING PENTING UNTUK DIUBAH!
        -DUSER_SETUP_LOADED=1
        -DST7796_DRIVER=1       ; UBAH dari ILI9341_2_DRIVER=1 ke ST7796_DRIVER=1
        -DUSE_HSPI_PORT=1
        -DTFT_HEIGHT=320        ; Tetap 320 (portrait height)
        -DTFT_WIDTH=480         ; UBAH dari 480 ke 480 (ini sudah benar)
        -DTFT_MISO=12          ; Pin display MISO
        -DTFT_MOSI=13          ; Pin display MOSI
        -DTFT_SCLK=14          ; Pin display SCK
        -DTFT_CS=15            ; Pin display CS
        -DTFT_DC=2             ; Pin display DC
        -DTFT_RST=27           ; Pin display RESET (untuk 3248S035C)
        -DTFT_BACKLIGHT_ON=HIGH
        -DSMOOTH_FONT=1

        ;TouchScreen Controller - UBAH untuk Capacitive Touch
        -DHAS_TOUCH=1
        -DHAS_CAPACITIVE_TOUCH=1   ; TAMBAH ini untuk capacitive touch GT911

        ;SD Card pins (sama)
        -DSDCARD_CS=5
        -DSDCARD_SCK=18
        -DSDCARD_MISO=19
        -DSDCARD_MOSI=23

        ;TFT Brightness Control
        -DTFT_BRIGHT_CHANNEL=0
        -DTFT_BRIGHT_Bits=8
        -DTFT_BRIGHT_FREQ=5000

        ;I2C untuk Capacitive Touch GT911
        -DGROVE_SDA=33          ; UBAH dari -1 ke 33 (GT911 SDA)
        -DGROVE_SCL=32          ; UBAH dari -1 ke 32 (GT911 SCL)

        -DSPI_SCK_PIN=18
        -DSPI_MOSI_PIN=23
        -DSPI_MISO_PIN=19
        -DSPI_SS_PIN=17         ; UBAH dari 27 ke 17
        -DDEVICE_NAME='"CYD-3248S035C"'  ; Ubah device name

lib_deps =
        ${env.lib_deps}

[env:CYD-2432S028]
extends=CYD_base
build_flags =
        ${CYD_base.build_flags}
        -DTFT_BL=21
        -DSPI_FREQUENCY=80000000      ; NAIK dari 40MHz ke 80MHz untuk ST7796
        -DSPI_READ_FREQUENCY=20000000 ; NAIK dari 16MHz ke 20MHz
        -DSPI_TOUCH_FREQUENCY=2500000 ; Tetap 2.5MHz
        -DTOUCH_CS=-1                 ; Capacitive touch pakai I2C, bukan SPI
        -DTOUCH_SDA=33               ; TAMBAH ini - GT911 SDA pin
        -DTOUCH_SCL=32               ; TAMBAH ini - GT911 SCL pin  
        -DTOUCH_INT=36               ; TAMBAH ini - GT911 interrupt pin
        -DTOUCH_RST=25               ; TAMBAH ini - GT911 reset pin
        -DDEVICE_NAME='"CYD-3248S035C"'  ; Ubah device name